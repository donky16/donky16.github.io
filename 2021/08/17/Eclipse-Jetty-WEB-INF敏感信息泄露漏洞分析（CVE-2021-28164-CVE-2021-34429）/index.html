<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans,en,default">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="HTTP,Jetty,信息泄露," />










<meta name="description" content="文章首发于先知社区，链接https://xz.aliyun.com/t/10039">
<meta name="keywords" content="HTTP,Jetty,信息泄露">
<meta property="og:type" content="article">
<meta property="og:title" content="Eclipse Jetty WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164&#x2F;CVE-2021-34429）">
<meta property="og:url" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/index.html">
<meta property="og:site_name" content="donky16">
<meta property="og:description" content="文章首发于先知社区，链接https://xz.aliyun.com/t/10039">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810152702885.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810155606892.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810155911607.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810160240670.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810190548557.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810162824794.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810163149094.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810163651765.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810164515860.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810164856181.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810165236348.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810165945373.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810170249534.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810171027594.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810172313869.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810174638264.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810181758597.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810175303636.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810180719502.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810181629428.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810183343378.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810185827346.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210811143941174.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210811145216423.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210811150324713.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210811150935871.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210811151234955.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210811152003611.png">
<meta property="og:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210811160338199.png">
<meta property="og:updated_time" content="2022-03-28T11:51:20.539Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eclipse Jetty WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164&#x2F;CVE-2021-34429）">
<meta name="twitter:description" content="文章首发于先知社区，链接https://xz.aliyun.com/t/10039">
<meta name="twitter:image" content="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/image-20210810152702885.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/"/>





  <title>Eclipse Jetty WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164/CVE-2021-34429） | donky16</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">donky16</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://donky.cn/2021/08/17/Eclipse-Jetty-WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164-CVE-2021-34429）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="donky16">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="donky16">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Eclipse Jetty WEB-INF敏感信息泄露漏洞分析（CVE-2021-28164/CVE-2021-34429）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-17T19:48:56+08:00">
                2021-08-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/漏洞分析/" itemprop="url" rel="index">
                    <span itemprop="name">漏洞分析</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/漏洞分析/协议安全/" itemprop="url" rel="index">
                    <span itemprop="name">协议安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>文章首发于先知社区，链接<a href="https://xz.aliyun.com/t/10039" target="_blank" rel="noopener">https://xz.aliyun.com/t/10039</a><a id="more"></a></p>
<p>本文主要从Jetty的两个WEB-INF信息泄露漏洞CVE-2021-28164和CVE-2021-34429，来分析如何通过编码和相对路径来绕过对敏感信息的校验，以及Jetty中对URL的PATH的解析方式和存在的问题。</p>
<h2 id="漏洞信息"><a href="#漏洞信息" class="headerlink" title="漏洞信息"></a>漏洞信息</h2><p>Jetty作为Eclipse基金会的一部分，是一个纯粹的基于Java的网页服务器和Java Servlet容器，其支持最新的Java Servlet API，同时支持WebSocket，SPDY，HTTP/2协议。</p>
<p>在Jetty9.4.37版本中，为了符合<a href="https://datatracker.ietf.org/doc/html/rfc3986#section-3.3" target="_blank" rel="noopener">RFC3986</a>中的规范，选择性地支持可能有歧义解释的URI，默认模式允许URL编码，简单看下RFC3986（替代<a href="https://datatracker.ietf.org/doc/html/rfc2396#section-3.3" target="_blank" rel="noopener">RFC2396</a>）的规定</p>
<p><img src="image-20210810152702885.png" alt="image-20210810152702885"> </p>
<p><code>.</code>和<code>..</code>称为点段，都是为路径名层次结构中的相对引用而定义的，它们在一些操作系统文件目录结构中分别代表当前目录和父目录。但是与文件系统不同的是，这些点段仅在 URI 路径中解释层次结构，并作为解析过程的一部分被删除。也就是说在解析URI路径时，需要先处理<code>.</code>和<code>..</code></p>
<p>Jetty为了符合这种处理方式，却导致了一系列的漏洞产生，首先是在9.4.39版本中修复了CVE-2021-28164，然后出现了新的绕过，其又在9.4.43版本中修复了CVE-2021-34429。</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>本文将选取Jetty 9.4.37、9.4.40、9.4.43三个版本来解析漏洞如何发生与其如何修复。</p>
<h3 id="CVE-2021-28164"><a href="#CVE-2021-28164" class="headerlink" title="CVE-2021-28164"></a>CVE-2021-28164</h3><p>此漏洞环境可以<a href="https://github.com/vulhub/vulhub/blob/master/jetty/CVE-2021-28164/README.zh-cn.md" target="_blank" rel="noopener">vulhub</a>上搭建，是9.4.37版本，<code>/%2e/WEB-INF/web.xml</code>直接可以读取web.xml</p>
<p>payload：<code>/%2e/WEB-INF/web.xml</code></p>
<p><img src="image-20210810155606892.png" alt="image-20210810155606892"> </p>
<h3 id="CVE-2021-34429"><a href="#CVE-2021-34429" class="headerlink" title="CVE-2021-34429"></a>CVE-2021-34429</h3><p>本地搭建环境Jetty 9.4.40（ps:懒得新建项目，勿在意项目名）</p>
<ol>
<li>payload1：<code>/%u002e/WEB-INF/web.xml</code></li>
</ol>
<p><img src="image-20210810155911607.png" alt="image-20210810155911607"> </p>
<p>这个payload可以看作CVE-2021-28164的绕过</p>
<ol>
<li>payload2: <code>/.%00/WEB-INF/web.xml</code></li>
</ol>
<p><img src="image-20210810160240670.png" alt="image-20210810160240670"></p>
<p>这个payload是由多个解析问题导致</p>
<ol>
<li>payload3：<code>/a/b/..%00/WEB-INF/web.xml</code> (<strong>这里是两层，你没有看错</strong>，下文分析原因)</li>
</ol>
<p><img src="image-20210810190548557.png" alt="image-20210810190548557"></p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>接下来我们将从源码角度，依次分析漏洞如何产生，由于CVE-2021-34429中的payload1是对CVE-2021-28164的绕过，我们直接调试Jetty 9.4.40版本。这里使用远程调试的方式，一开始搜教程一直调试无法成功，最后发现端口从8787设置到4000行了,参考<a href="https://stackoverflow.com/questions/27311620/how-to-debug-in-jetty-source-code" target="_blank" rel="noopener">how-to-debug-in-jetty-source-code)<em>**</em></a>，具体原因未研究。</p>
<p>由于漏洞主要发生在URI解析过程中，所以我们可以直接在<code>org.eclipse.jetty.http.HttpURI.java:Parse</code>函数中下断点，开启调试</p>
<p><img src="image-20210810162824794.png" alt="image-20210810162824794"></p>
<p>然后使用<code>/%u002e/WEB-INF/web.xml</code>发包，跟踪代码执行</p>
<p><img src="image-20210810163149094.png" alt="image-20210810163149094"></p>
<p>当解析完成path之后，会先调用<code>canonicalPath</code>函数，这是漏洞产生的第一个重点函数，主要是用于路径的规范化，也就是处理<code>.</code>和<code>..</code>，我们先直接跳过</p>
<p><img src="image-20210810163651765.png" alt="image-20210810163651765"></p>
<p>由于是在规范化点段，然而并没有出现点段，只含有%u编码后的<code>.</code>，结果依然是原来的路径，接着我们进入<code>decodePath</code>函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decodePath</span><span class="params">(String path, <span class="keyword">int</span> offset, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          Utf8StringBuilder builder = <span class="keyword">null</span>;</span><br><span class="line">          <span class="keyword">int</span> end = offset + length;</span><br><span class="line"></span><br><span class="line">          label67:</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">int</span> i = offset; i &lt; end; ++i) &#123;</span><br><span class="line">              <span class="keyword">char</span> c = path.charAt(i);</span><br><span class="line">              <span class="keyword">switch</span>(c) &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">'%'</span>:</span><br><span class="line">                  <span class="keyword">if</span> (builder == <span class="keyword">null</span>) &#123;</span><br><span class="line">                      builder = <span class="keyword">new</span> Utf8StringBuilder(path.length());</span><br><span class="line">                      builder.append(path, offset, i - offset);</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">if</span> (i + <span class="number">2</span> &gt;= end) &#123;</span><br><span class="line">                      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Bad URI % encoding"</span>);</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">char</span> u = path.charAt(i + <span class="number">1</span>);</span><br><span class="line">                  <span class="keyword">if</span> (u == <span class="string">'u'</span>) &#123;</span><br><span class="line">                      builder.append((<span class="keyword">char</span>)(<span class="string">'\uffff'</span> &amp; TypeUtil.parseInt(path, i + <span class="number">2</span>, <span class="number">4</span>, <span class="number">16</span>)));</span><br><span class="line">                      i += <span class="number">5</span>;</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      builder.append((<span class="keyword">byte</span>)(<span class="number">255</span> &amp; TypeUtil.convertHexDigit(u) * <span class="number">16</span> + TypeUtil.convertHexDigit(path.charAt(i + <span class="number">2</span>))));</span><br><span class="line">                      i += <span class="number">2</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">';'</span>:</span><br><span class="line">                  <span class="keyword">if</span> (builder == <span class="keyword">null</span>) &#123;</span><br><span class="line">                      builder = <span class="keyword">new</span> Utf8StringBuilder(path.length());</span><br><span class="line">                      builder.append(path, offset, i - offset);</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">do</span> &#123;</span><br><span class="line">                      ++i;</span><br><span class="line">                      <span class="keyword">if</span> (i &gt;= end) &#123;</span><br><span class="line">                          <span class="keyword">continue</span> label67;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125; <span class="keyword">while</span>(path.charAt(i) != <span class="string">'/'</span>);</span><br><span class="line"></span><br><span class="line">                  builder.append(<span class="string">'/'</span>);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">default</span>:</span><br><span class="line">                  <span class="keyword">if</span> (builder != <span class="keyword">null</span>) &#123;</span><br><span class="line">                      builder.append(c);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (builder != <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> builder.toString();</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (offset == <span class="number">0</span> &amp;&amp; length == path.length()) &#123;</span><br><span class="line">              <span class="keyword">return</span> path;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> path.substring(offset, end);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (NotUtf8Exception var8) &#123;</span><br><span class="line">          LOG.debug(path.substring(offset, offset + length) + <span class="string">" "</span> + var8, <span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">          <span class="keyword">return</span> decodeISO88591Path(path, offset, length);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IllegalArgumentException var9) &#123;</span><br><span class="line">          <span class="keyword">throw</span> var9;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception var10) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"cannot decode URI"</span>, var10);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，此解码函数，支持%编码和%u编码，并且支持<code>;</code>作为param的解析</p>
<p><img src="image-20210810164515860.png" alt="image-20210810164515860"></p>
<p>解析完的路径自然就变成了<code>/HelloTomcat/./WEB-INF/web.xml</code>，那最后怎么绕过敏感文件校验的呢？我们需要继续调试。</p>
<p>在一波操作之后，经过漫长的调用链</p>
<p><img src="image-20210810164856181.png" alt="image-20210810164856181"> </p>
<p>找到了在<code>org.eclipse.jetty.server.handler.ContextHandler.java</code>的<code>isProtectedTarget</code>函数中的校验代码。</p>
<p><img src="image-20210810165236348.png" alt="image-20210810165236348"></p>
<p>最终会拿刚才<code>decodePath</code>也就是<code>/HelloTomcat/./WEB-INF/web.xml</code>截取项目名之后的路径进行保护文件的校验</p>
<p><img src="image-20210810165945373.png" alt="image-20210810165945373"></p>
<p>能够看到，默认的保护列表有两个<code>/web-inf</code>和<code>/meta-inf</code>，我们继续进入</p>
<p><img src="image-20210810170249534.png" alt="image-20210810170249534"></p>
<p>很明显，也进行了小写的转换，但是在校验路径是否是以保护文件夹开头时，是直接拿decodePath进行的校验，当然<code>/./WEB-INF/web.xml</code>并不是以<code>/web-inf</code>开头，此时就解释了为什么一个编码的<code>.</code>会绕过安全校验，但是我们还是没看到，为什么会读取到web.xml，需要接着调试</p>
<p>又经过一个漫长的调用链，可以同样在<code>ContentHandler.java</code>的<code>getResource</code>函数中找到答案</p>
<p><img src="image-20210810171027594.png" alt="image-20210810171027594"></p>
<p>在获取资源之前，调用的相同的规范路径的函数<code>canonicalPath</code>，当然会将<code>/./WEB-INF/web.xml</code>规范化未<code>/WEB-INF/web.xml</code>，从而完成了整个漏洞的利用。</p>
<p>到这里，payload1完成分析，简单理一下</p>
<ol>
<li>输入path=<code>/HelloTomcat/%u002e/WEB-INF/web.xml</code></li>
<li>规范化<code>canonicalPath(path)</code>  ==&gt; path= <code>/HelloTomcat/%u002e/WEB-INF/web.xml</code></li>
<li>URL解码<code>decodePath(path)</code>  ==&gt;  path=<code>/HelloTomcat/./WEB-INF/web.xml</code></li>
<li>取target=<code>/./WEB-INF/web.xml</code></li>
<li>安全校验<code>isProtectTarget(target)</code>  ==&gt; target= <code>/./WEB-INF/web.xml</code>并不是以<code>/web-inf</code>或<code>/web-meta</code>开头，通过校验</li>
<li>规范化<code>canonicalPath(target)</code>  ==&gt; target= <code>/WEB-INF/web.xml</code></li>
<li>获取资源<code>getResource(target)</code>，造成web.xml被读取</li>
</ol>
<p>那我们接着分析CVE-2021-28164的中payload，由于上文分析的payload1是其绕过，我们直接用9.4.40版本，查看是如何修补的CVE-2021-28164，并分析，payload1是如何被绕过的。</p>
<p>我们首先查看在9.4.39版本对CVE-2021-28164的修补的<a href="https://github.com/eclipse/jetty.project/commit/e412c8a15b3334b30193f40412c0fbc47e478e83" target="_blank" rel="noopener">Commit</a></p>
<p><img src="image-20210810172313869.png" alt="image-20210810172313869"></p>
<p>从中间的注释可以看出来，当路径中出现可能存在歧义的并且合法的段时，即使可能已经被规范化，但是在这里还要继续规范化。说起来可能比较绕，我们直接在<code>org.eclipse.jetty.server.Reqest.Java</code>中<code>setMetaData</code>函数的这个增加的位置设置断点，接着发送<code>/HelloTomcat/%2e/WEB-INF/web.xml</code>payload。</p>
<p><img src="image-20210810174638264.png" alt="image-20210810174638264"></p>
<p>进入<code>uri.isAmbiguous</code>函数，只有<code>_ambigouos</code>不为空，就返回true</p>
<p><img src="image-20210810181758597.png" alt="image-20210810181758597"></p>
<p>可以看到这里<code>ambiguos</code>是true，也就代表着此路径被认定是可能存在歧义的，我们接着跟</p>
<p><img src="image-20210810175303636.png" alt="image-20210810175303636"></p>
<p>到增加的代码处，path如果不是只有<code>/</code>，就需要获取其被解码后的path，也就是上文第3步处理后得到的值，当ambiguous为true时，path会被继续规范化，那么此时path就变成了<code>/HelloTomcat/WEB-INF/web.xml</code>。</p>
<p>总结就是，为了修复CVE-2021-28164，在第三步处理完path后，验证path是否一个可能含有歧义的路径，如果是，就直接在进行一次规范化，这样经过规范化，在进行保护文件校验时，就不会通过校验，从而避免敏感信息泄露。</p>
<p>我们这个例子是使用<code>%2e</code>，那么<code>%u002e</code>是如何绕过这个规范化的呢？此时需要看<code>ambiguous</code>是何时被置为true的，既然可以绕过，那说明<code>%u002e</code>并没有被认定为歧义。</p>
<p>回到最初的<code>org.eclipse.jetty.http.HttpURI.java:Parse</code>函数，我们看下在解析路径的时候，这些属性是如何设置的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> PATH:</span><br><span class="line">    <span class="keyword">switch</span>(c) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'#'</span>:</span><br><span class="line">        <span class="keyword">this</span>.checkSegment(uri, segment, i, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>._path = uri.substring(pathMark, i);</span><br><span class="line">        mark = i + <span class="number">1</span>;</span><br><span class="line">        state = HttpURI.State.FRAGMENT;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'%'</span>:</span><br><span class="line">        encoded = <span class="keyword">true</span>;</span><br><span class="line">        escapedSlash = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'.'</span>:</span><br><span class="line">        dot |= segment == i;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">        <span class="keyword">this</span>.checkSegment(uri, segment, i, <span class="keyword">false</span>);</span><br><span class="line">        segment = i + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'2'</span>:</span><br><span class="line">        escapedSlash = escapedSlash == <span class="number">1</span> ? <span class="number">2</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">';'</span>:</span><br><span class="line">        <span class="keyword">this</span>.checkSegment(uri, segment, i, <span class="keyword">true</span>);</span><br><span class="line">        mark = i + <span class="number">1</span>;</span><br><span class="line">        state = HttpURI.State.PARAM;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'?'</span>:</span><br><span class="line">        <span class="keyword">this</span>.checkSegment(uri, segment, i, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>._path = uri.substring(pathMark, i);</span><br><span class="line">        mark = i + <span class="number">1</span>;</span><br><span class="line">        state = HttpURI.State.QUERY;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'F'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'f'</span>:</span><br><span class="line">        <span class="keyword">if</span> (escapedSlash == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>._ambiguous.add(HttpURI.Ambiguous.SEPARATOR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        escapedSlash = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        escapedSlash = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，最明显的是出现%2f或者%2F时，就会直接设置<code>_ambiguous</code>增加一个<code>SEPARATOR</code>代表含有编码的分隔符。当出现<code>/;?#</code>，都会进入<code>checkSegment</code>函数</p>
<p><img src="image-20210810180719502.png" alt="image-20210810180719502"></p>
<p>当遇到<code>/</code>会取此<code>/</code>前面一个段的值，如<code>/HelloTomcat/%2e/WEB-INF/web.xml</code>，解析到第三个<code>/</code>时，会取<code>%2e</code>，并在<code>__ambiguousSegments</code>中寻找是否存在，如果存在就在<code>_ambiguous</code>增加<code>SEGMENT</code>，如果不存在，并且含有param，就在<code>_ambiguous</code>增加<code>PARAM</code>，这个<code>__ambiguousSegments</code>为</p>
<p><img src="image-20210810181629428.png" alt="image-20210810181629428"></p>
<p>此时，就能够解释为什么<code>%u002e</code>可以绕过了，因为这个歧义列表中不包含<code>%u002e</code>，所以绕过了歧义验证。</p>
<p>接下来还有一个payload2：<code>/HelloTomcat/.%00/WEB-INF/web.xml</code></p>
<p>我们前面给出<code>decodePath</code>函数的代码，接下来，想要解释这个payload，需要看下<code>canonicalPath</code>函数</p>
<p><img src="image-20210810183343378.png" alt="image-20210810183343378"></p>
<p>这段代码很奇葩，在规范化的过程中，特意考虑了<code>\u0000</code>，当出现空字符时，如果空字符前只有1个点或者超过2个点的时候，直接break，将空字符忽略直接丢掉。</p>
<p>所以在上述解析的第5步，保护文件校验是使用<code>/.\u0000/WEB-INF/web.xml</code>，从而绕过了校验，而在获取资源之前的第6步的规范化，又将这个空字符直接丢掉了，所以导致最终web.xml的文件读取。</p>
<p>当我看这段代码的时候，发现了更奇葩的事情，当出现两个点的时候，如<code>/a/b/..\u0000</code>，canonical=<code>/a/b/</code>,此时解析到空字符时，会先将长度减1，也就是丢掉最后一个<code>/</code>，变为<code>/a/b</code>，然后找到最后的分隔符，并截取到最后一个空字符，也就是最终变为<code>/a/</code>，不仅忽略了空字符，也完成了<code>../</code>的规范化，可是之后并<strong>没有将dot设置为0</strong>，也就等于使用了，但是并没有初始化，接着看下面代码</p>
<p><img src="image-20210810185827346.png" alt="image-20210810185827346"></p>
<p>解析完空字符，就解析<code>/</code>，那么此时dots还是等于2，会再进行一次<code>../</code>的规范化操作，这就导致一次<code>..\u0000</code>，解析成了<code>../../</code>的作用。</p>
<p>到这里，我们构造出了奇葩payload3</p>
<h2 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h2><p>如果修复payload1，按照修复CVE-2021-28164的方式，在<code>__ambiguousSegments</code>中增加<code>%u002e</code>类似的歧义字符，是可以的。但是Jetty并没有这么做，而是直接选择了不按照RFC规范来了。</p>
<p><img src="image-20210811143941174.png" alt="image-20210811143941174"></p>
<p>这是最新版9.4.43中<code>org.eclipse.jetty.http.HttpURI.java</code>中新加的注释。也就是说，通过在规范化相对路径之前进行url解码和删除参数，歧义的路径就不存在了，但是这是一种非标准的方法，因为RFC3986要求需要先规范化，在进行解码和删除参数，也就是9.4.37-9.4.42之间（包含）的版本的处理方式才是标准的。</p>
<p><img src="image-20210811145216423.png" alt="image-20210811145216423"></p>
<p>通过上边修复的代码，我们上文中提到的解析方式的第2步和第3步就换了位置，最终变成了</p>
<ol>
<li>输入path=<code>/HelloTomcat/%u002e/WEB-INF/web.xml</code></li>
<li>URL解码<code>decodePath(path)</code>  ==&gt;  path=<code>/HelloTomcat/./WEB-INF/web.xml</code></li>
<li>规范化<code>canonicalPath(path)</code>  ==&gt; path= <code>/HelloTomcat/WEB-INF/web.xml</code></li>
<li>取target=<code>/WEB-INF/web.xml</code></li>
<li>安全校验<code>isProtectTarget(target)</code>  ==&gt; target= <code>/WEB-INF/web.xml</code>，是以<code>/web-inf</code>或<code>/web-meta</code>开头，无法通过校验，返回404</li>
</ol>
<p>这种直接就修复了这种漏洞，先解码在规范化，是不会发生有歧义的路径进入后面的安全校验的。</p>
<p>接下来需要研究payload2和payload3，针对空字符的处理，虽然经过上述的修复，出现%00，也不会出现安全问题，但是从上面解析空字符的代码看，<code>..%00</code>的解析依然会进行两层父目录的跳转，这是一个功能问题，当然也是潜在的安全问题。</p>
<p>我们先来看下RFC3986对空字符的规范</p>
<p><img src="image-20210811150324713.png" alt="image-20210811150324713"> </p>
<p>在7.3节中，在url解码过后，需要进行安全性的检查，需要注意<code>%00</code>应该被特殊处理，如果后端不希望接受原始数据，应该拒绝，感觉说了句废话，个人理解就是，需要特别注意下空字符。当然jetty 9.4.43也很符合RFC，直接将对于空字符的处理（<code>case   &#39;\u0000&#39;</code>部分）删掉了。</p>
<p><img src="image-20210811150935871.png" alt="image-20210811150935871"></p>
<p>而且在截取uri中path的时候就直接加了处理</p>
<p><img src="image-20210811151234955.png" alt="image-20210811151234955"></p>
<p>无论出现%编码还是%u编码，就直接先解码这个字符，然后验证，如果此值为0，代表空字符，就直接报错<code>Illegal character in path</code>，当然这里也考虑了%25两次%编码，和%2f分隔符的%编码，增加到<code>_violations</code>中，用于记录路径中含有的编码数据类型。</p>
<h2 id="一点想法"><a href="#一点想法" class="headerlink" title="一点想法"></a>一点想法</h2><p>首先就是，最开始说到，jetty支持选择性的解析可能歧义的路径，这里可以接着说下。</p>
<p>上边说到在解析的时候把一些可能引起歧义的编码数据类型加到了<code>_violations</code>中，看下后续如何使用这些数据。</p>
<p><img src="image-20210811152003611.png" alt="image-20210811152003611"></p>
<p>这里就是在检查uri中的数据是否含有不允许出现的字符，而这个允许与否的名单是由一个<code>RFC7230_LEGACY</code>获取的，这个值可以在jetty配置文件的start.ini中通过<code>jetty.http.compliance</code>来配置，比如配置<code>jetty.http.compliance=RFC7230_NO_AMBIGUOUS_PATH_SEPARATORS</code>，那么<code>%2f</code>就会被认为不允许的字符。</p>
<p>接着还有一个问题就是，我们可以看到在<code>decodePath</code>函数中，解码和参数删除部分，jetty只是考虑了<code>;</code>，然而这是不规范的，对于RFC3986来说</p>
<p><img src="image-20210811160338199.png" alt="image-20210811160338199"> </p>
<p><code>name;v=1.1</code>和<code>name,v=1.1</code>是等价的，如果不把<code>,</code>当作path中的参数分隔符进行解析，可能存在潜在的安全问题。</p>
<p>最后，jetty在9.4.37中，实现标准的RFC3986中解析路径的部分，从而导致了这些安全问题。问题到底出在什么地方呢？其实从上面的分析来看，主要就是一个简单的顺序问题。</p>
<p>RFC3986认为当解析uri中路径时，需要先去除掉其中含有的点段<code>.</code>和<code>..</code>，将之处理成当前目录或者跳到父目录，之后才能进行url的解码和参数处理。jetty照这个来了，却出现了安全问题，然而在修复了一次之后，又出现了绕过，索性直接不按照RFC，变成了先解码和参数处理，再进行规范化（处理点段）。</p>
<p>所以需要思考一个问题，一个路径是<code>/%2e/a/b</code>，后端解析之后，到底是<code>/./a/b</code>还是<code>/a/b</code>？个人理解是RFC规范的是正确的，既然存在<code>.</code>的url编码<code>%2e</code>，那么就是告诉后端我发送的是一个点，而不是一个要代表当前目录的<code>.</code>，如果直接进行解码之后规范化，那么在url编码中%2e将没有意义。</p>
<p>然而jetty改来改去，最终还是没在根源上解决这个问题，如果使用RFC3986规范的标准解析，这些安全问题应该如何解决。我们看上面的9.4.40版本解析步骤，在第5步进行安全校验的时候，使用的是解析后的路径含有点段，然后再第6步获取资源之前，其实又进行了一次规范化。也就是说其实在最终使用路径的时候是进行规范化的，那么在安全校验的时候为什么不进行这个规范化呢？</p>
<p>如果安全性校验的时候可以进行规范化，是不是可以既能标准解析又能解决安全问题呢？</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://datatracker.ietf.org/doc/html/rfc3986#section-3.3" target="_blank" rel="noopener">https://datatracker.ietf.org/doc/html/rfc3986#section-3.3</a></p>
<p><a href="https://datatracker.ietf.org/doc/html/rfc2396#section-3.3" target="_blank" rel="noopener">https://datatracker.ietf.org/doc/html/rfc2396#section-3.3</a></p>
<p><a href="https://github.com/vulhub/vulhub/blob/master/jetty/CVE-2021-28164/README.zh-cn.md" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/blob/master/jetty/CVE-2021-28164/README.zh-cn.md</a></p>
<p><a href="https://github.com/advisories/GHSA-vjv5-gp2w-65vm" target="_blank" rel="noopener">https://github.com/advisories/GHSA-vjv5-gp2w-65vm</a></p>
<p><a href="https://github.com/eclipse/jetty.project/commit/e412c8a15b3334b30193f40412c0fbc47e478e83" target="_blank" rel="noopener">https://github.com/eclipse/jetty.project/commit/e412c8a15b3334b30193f40412c0fbc47e478e83</a></p>
<p><a href="https://github.com/eclipse/jetty.project/security/advisories/GHSA-vjv5-gp2w-65vm" target="_blank" rel="noopener">https://github.com/eclipse/jetty.project/security/advisories/GHSA-vjv5-gp2w-65vm</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/HTTP/" rel="tag"># HTTP</a>
          
            <a href="/tags/Jetty/" rel="tag"># Jetty</a>
          
            <a href="/tags/信息泄露/" rel="tag"># 信息泄露</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/08/06/HTTP-2降级走私攻击/" rel="next" title="HTTP/2降级走私攻击">
                <i class="fa fa-chevron-left"></i> HTTP/2降级走私攻击
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/10/28/从RFC看如何使用Base64编码绕过WAF/" rel="prev" title="从RFC看如何使用Base64编码绕过WAF">
                从RFC看如何使用Base64编码绕过WAF <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">donky16</p>
              <p class="site-description motion-element" itemprop="description">质性自然，非矫历所得</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞信息"><span class="nav-number">1.</span> <span class="nav-text">漏洞信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞利用"><span class="nav-number">2.</span> <span class="nav-text">漏洞利用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CVE-2021-28164"><span class="nav-number">2.1.</span> <span class="nav-text">CVE-2021-28164</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CVE-2021-34429"><span class="nav-number">2.2.</span> <span class="nav-text">CVE-2021-34429</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞分析"><span class="nav-number">3.</span> <span class="nav-text">漏洞分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#漏洞修复"><span class="nav-number">4.</span> <span class="nav-text">漏洞修复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一点想法"><span class="nav-number">5.</span> <span class="nav-text">一点想法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">6.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">donky16</span>

  
</div>

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
